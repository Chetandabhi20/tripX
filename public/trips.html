<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Trips - TripX</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #f8ffae 0%, #43c6ac 100%); font-family: 'Segoe UI', Arial, sans-serif; min-height: 100vh; padding-bottom: 60px; }
        .nav ul { list-style: none; background: #222; padding: 10px 0; display: flex; justify-content: center; gap: 30px; margin-bottom: 30px; }
        .nav ul li a { color: #fff; text-decoration: none; font-weight: 500; padding: 8px 16px; border-radius: 4px; transition: background 0.2s; }
        .nav ul li a:hover { background: #43c6ac; color: #222; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .trips-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .add-trip-btn { background: linear-gradient(135deg, #43c6ac 0%, #2c8c7c 100%); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; text-decoration: none; transition: transform 0.2s; }
        .add-trip-btn:hover { transform: translateY(-2px); }
        .trips-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .trip-card { background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); transition: transform 0.3s; padding: 20px; }
        .trip-card:hover { transform: translateY(-5px); }
        .trip-title { font-size: 1.5em; color: #222; margin-bottom: 10px; }
        .trip-date { color: #666; font-size: 0.9em; margin-bottom: 15px; }
        .trip-status { display: inline-block; padding: 5px 10px; border-radius: 15px; font-size: 0.9em; margin-top: 15px; text-transform: capitalize; }
        .status-upcoming { background-color: #e3f2fd; color: #1976d2; }
        .status-ongoing { background-color: #e8f5e9; color: #388e3c; }
        .status-completed { background-color: #f5f5f5; color: #616161; }
        #message-container { text-align: center; padding: 20px; background: rgba(255, 255, 255, 0.8); border-radius: 8px; }
    </style>
</head>
<body>
    <div class="nav">
        <ul>
            <li><a href="home.html">Home</a></li>
            <li><a href="trips.html">Trips</a></li>
            <li><a href="profile.html">Account</a></li>
            <li><a href="expense.html">Expense</a></li>
            <li><a href="">Bookings</a></li>
            <li><a href="photos.html">Photos</a></li>
        </ul>
    </div>
    <div class="container">
        <div class="trips-header">
            <h1>Your Trips</h1>
            <a href="addtrip.html" class="add-trip-btn">Add New Trip</a>
        </div>
        <div class="trips-grid" id="trips-container">
            <!-- Trips will be dynamically loaded here -->
        </div>
        <div id="message-container" style="display: none;"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const tripsContainer = document.getElementById('trips-container');
        const messageContainer = document.getElementById('message-container');

        function showMessage(text) {
            messageContainer.textContent = text;
            messageContainer.style.display = 'block';
        }

        async function fetchTrips() {
            try {
                const response = await fetch('get_trips.php');
                const data = await response.json();

                if (data.success) {
                    renderTrips(data.trips);
                } else {
                    showMessage(data.message || 'Could not fetch trips.');
                    if (data.message.includes('authenticated')) {
                        // Redirect to login if not logged in
                        setTimeout(() => window.location.href = 'login.php', 2000);
                    }
                }
            } catch (error) {
                showMessage('An error occurred while fetching your trips.');
                console.error('Fetch error:', error);
            }
        }

        function renderTrips(trips) {
            tripsContainer.innerHTML = ''; // Clear previous content
            if (trips.length === 0) {
                showMessage("You haven't added any trips yet. Click 'Add New Trip' to get started!");
                return;
            }
            messageContainer.style.display = 'none';

            trips.forEach(trip => {
                const card = document.createElement('div');
                card.className = 'trip-card';
                card.innerHTML = `
                    <h2 class="trip-title">${escapeHTML(trip.trip_name)}</h2>
                    <div class="trip-date">${formatDate(trip.start_date)} - ${formatDate(trip.end_date)}</div>
                    <p><strong>Destination:</strong> ${escapeHTML(trip.destination)}</p>
                    <p>${escapeHTML(trip.description)}</p>
                    <span class="trip-status status-${trip.status}">${trip.status}</span>
                `;
                tripsContainer.appendChild(card);
            });
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function escapeHTML(str) {
            return str.replace(/[&<>"']/g, function(match) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                }[match];
            });
        }

        fetchTrips();
    });
    </script>
</body>
</html>
